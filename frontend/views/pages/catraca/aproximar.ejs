
<style>
 @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Fira+Sans:ital,wght@0,500;1,500&family=Merriweather+Sans&display=swap');

.fonte-personalizada{
  font-family: 'Bebas Neue', sans-serif;
}

  </style>

<body>
    <div class="container custom-shadow  rounded-5  ">
        <h4 class="mt-5 rounded-5" id="data-e-hora"></h4>
        <h1 class="fonte-personalizada">APROXIME O CARTÃO</h1>
        <img src="/img/aproximar.png" >
        <h6 class="fonte-personalizada">Linha 115</h6>
        <p class="fonte-personalizada">www.SmartBus.com.br</p>
       

        <script>
          function mostrarDataHora() {
            const elementoDataHora = document.getElementById("data-e-hora");
            elementoDataHora.style.color = "#eaeaea"; // Define a cor principal do Bootstrap
            elementoDataHora.style.fontFamily = "Inria Sans, sans-serif"; // Define a fonte do Bootstrap
            elementoDataHora.style.fontWeight = "bold"; // Define o peso da fonte como negrito
            function atualizarDataHora() {
              const data = new Date();
              const dataFormatada = data.toLocaleDateString();
              const horaFormatada = data.toLocaleTimeString();
              elementoDataHora.textContent = `Data: ${dataFormatada} - Hora: ${horaFormatada}`;
            }
            setInterval(atualizarDataHora, 1000); // Atualiza a cada segundo
            atualizarDataHora(); // Para exibir imediatamente
          }

          mostrarDataHora();
        </script>
      </div>
    </div>

<form id="formulario" name="formulario">
    <input type="text" name="leitor" id="leitor"  />
  </form>


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const leitor = document.querySelector("#leitor");
        leitor.focus();
      });


      // const leitor = document.querySelector("#leitor");
      // leitor.addEventListener("input", function() {
      //   alert("RFID:" + leitor.value);
      //   window.location.href = "/catraca/liberado";       
      // });
    </script>



<!-- 
  <script>
    function verificarSaldo() {
      // Simulação de consulta ao banco de dados
      const idDigitado = document.getElementById("leitor").value;
      const saldoNoBanco = obterSaldoDoBanco(idDigitado);

      if (saldoNoBanco >= 5) {
        // Caso o saldo seja suficiente
        deletarSaldoNoBanco(idDigitado, 5);
        window.location.href = "catraca/liberado";
      } else {
        // Caso o saldo seja insuficiente
        window.location.href = "catraca/negado";
      }
    }

    function obterSaldoDoBanco(id) {
      // Simulação da função para obter saldo do banco de dados
      // Substitua isso com sua lógica de consulta real
      const dadosDoBanco = {
        "123": 10, // Exemplo de ID e saldo
        "456": 3,
        // Adicione mais IDs e saldos conforme necessário
      };

      return dadosDoBanco[id] || 0;
    }

    function deletarSaldoNoBanco(id, valor) {
      // Simulação da função para deletar saldo do banco de dados
      // Substitua isso com sua lógica de remoção real
      // Normalmente, seria uma chamada AJAX para um servidor
      console.log(`Removendo ${valor} do saldo do ID ${id}`);
    }
  </script>



<form action="/verificar-saldo" method="post" onsubmit="return verificarSaldo()">
  <label for="leitor">AQUI VEM O ID</label>
  <input type="text" name="leitor" id="leitor" />

</form>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const leitor = document.querySelector("#leitor");
      leitor.focus();
  });

  function verificarSaldo() {
      const idDigitado = document.getElementById("leitor").value;
      const saldoNoBanco = obterSaldoDoBanco(idDigitado);

      if (saldoNoBanco >= 5) {
          deletarSaldoNoBanco(idDigitado, 5);
          alert("Saldo Suficiente. Redirecionando para Catraca Liberada.");
          window.location.href = "/catraca/liberado";
          return false; // Evitar que o formulário seja submetido
      } else {
          alert("Saldo Insuficiente. Redirecionando para Catraca Negada.");
          window.location.href = "/catraca/negado";
          return false; // Evitar que o formulário seja submetido
      }
  }

  function obterSaldoDoBanco(id) {
      const dadosDoBanco = {
          "123": 10,
          "456": 3,
      };

      return dadosDoBanco[id] || 0;
  }

  function deletarSaldoNoBanco(id, valor) {
      console.log(`Removendo ${valor} do saldo do ID ${id}`);
      // Adicione aqui a lógica real para remover o saldo no banco de dados
  }
</script> -->


<script>
  document.addEventListener("DOMContentLoaded", function () {
    const leitor = document.querySelector("#leitor");
    leitor.focus();
  });


  
  // abaixo codigo funcional do editar
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      // const id = window.location.pathname.split('/').pop();
     
      const form = document.querySelector('#formulario');
      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        if (form.checkValidity()) {
          try {
            const formData = new FormData(form);
            let saldo = -5 ;
            let cardnumber = formData.get("cardnumber");
            
            saldo = parseFloat(saldo)

            const data = { cardnumber, saldo };

            await axios.patch(`http://127.0.0.1:5000/cliente/recarregar`, data);

            alert("Transação completa com sucesso.");
            // window.location.href = `/site/perfil`;
          } catch (error) {
            console.log(error);
            // alert(error.response.data.mensagem);
          }
        }

        form.classList.add('was-validated');
      }, false);
    } catch (error) {
      console.log(error);

      if (error?.response?.status === 404) {
        alert("Transação não concluida.");
        window.location.href = "/site/perfil";
      } else {
        // alert(error.response.data.mensagem);
      }
    }

  });






  const leitor = document.querySelector("#leitor");
  leitor.addEventListener("input", function() {
    alert("RFID:" + leitor.value);
    window.location.href = "/catraca/liberado";       
  });
</script>



</body>

